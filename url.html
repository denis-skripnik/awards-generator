<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Получение токенов из фонда наград VIZ: генерация Url</title>
		<script src="js/jquery.min.js"></script>
<script>
function view_url() {
var form = document.getElementById('AwardUrlForm');
var data = {target: form.target.value, energy: form.energy.value, custom_sequence: form.custom_sequence.value, memo: form.memo.value, beneficiaries: form.beneficiaries.value, redirect: form.redirect.value};
$("#award_url").css("display", "block");
$("#award_url").html(`<h2>Сформированный url награды:</h2>
<textarea id="award_textarea"></textarea>`);

var url_str = '';
url_str += 'https://liveblogs.space/awards?';
for (key in data) {
if (data[key]) {
    url_str += key + '=' + data[key] + '&';
}
}
url_str = url_str.replace(/&\s*$/, "");

$("#award_textarea").html(url_str);
}
</script>
    </head>
<body>
<h1>Форма генерации Url награды</h1>
<p>В полях названия, как в url, а в скобках пояснения.</p>
<form id="AwardUrlForm">
<p><label for="target">target (кого наградить):</label></p>
<p><input type="text" name="target" value=""></p>
<p><label for="energy">Energy (процент энергии, который вы готовы потратить при награде):</label></p>
<p><input type="text" name="energy" id="awarding_energy" value="" onchange="localStorage.setItem('energy_percent', this.value)" ></p>
<p><label for="custom_sequence">custom_sequence (номер Custom операции, отправленной пользователем, которому предназначена награда. в принципе, можно указать любое число, например, id новости, опубликованной пользователем, в базе данных вашего сайта):</label></p>
<p><input type="text" name="custom_sequence" value=""></p>
<p><label for="memo">Memo (Заметка. Может быть любой текст или идентификация вашего приложения):</label></p>
<p><input type="text" name="memo" value=""></p>
<p><label for="beneficiaries">beneficiaries (Бенефициары):</label></p>
<p><input type="text" name="beneficiaries" value="" placeholder="denis-skripnik:30,on1x:50"></p>
<p><label for="redirect">redirect (ссылка для перенаправления после успешной награды):</label></p>
<p><input type="text" name="redirect" value=""></p>
<p><strong><input type="button" onclick="view_url()" value="Сформировать URL"></strong></p>
</form>
<div id="award_url" style="display: none;">
<h2>Адрес награды:</h2>
<textarea iid="award_textarea></textarea>
</div>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Получение токенов из фонда наград VIZ: форма</title>
		<script src="js/jquery.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/viz-world-js@latest/dist/viz.min.js" type="text/javascript"></script>
		<script src="js/helper.js"></script>
<script>
if (localStorage.getItem('login')) {
    var current_user = localStorage.getItem('login');
viz.api.getAccounts([current_user],function(err,response){    if(!err){     if(typeof response[0] !== 'undefined'){      let last_vote_time=Date.parse(response[0].last_vote_time);      let delta_time=parseInt((new Date().getTime() - last_vote_time+(new Date().getTimezoneOffset()*60000))/1000);      let energy=response[0].energy;      let new_energy=parseInt(energy+(delta_time*10000/432000));//CHAIN_ENERGY_REGENERATION_SECONDS 5 days      if(new_energy>10000){       new_energy=10000; }
$("#now_energy").html('Актуальная энергия пользователя ' + current_user + ': ' + new_energy/100 + '%');
}
}
});
} else {
$("#now_energy").css("display", "none");
}
</script>
		</head>
<body>
<h1>Заполните поля, чтобы отправить награду</h1>
<h2 id ="now_energy"></h2>
<form method="get" action="https://liveblogs.space/awards/">
<p><label for="target">Кого наградить:</label></p>
<p><input type="text" name="target" value=""></p>
<p><label for="energy">Процент энергии, который вы готовы потратить при награде. Энергия регенерирует за сутки на 20%:</label></p>
<p><input type="text" name="energy" id="awarding_energy" value="" onchange="localStorage.setItem('energy_percent', this.value)" ></p>
<p><label for="custom_sequence">Номер Custom операции, отправленной пользователем, которому предназначена награда (в принципе, можно указать любое число, например, id новости, опубликованной пользователем, в базе данных вашего сайта):</label></p>
<p><input type="text" name="custom_sequence" value=""></p>
<p><label for="memo">Заметка (memo):</label></p>
<p><input type="text" name="memo" value=""></p>
<p><label for="beneficiaries">Бенефициары:</label></p>
<p><input type="text" name="beneficiaries" value="" placeholder="denis-skripnik:30,on1x:50"></p>
<p><label for="redirect">Ссылка для перенаправления после успешной награды:</label></p>
<p><input type="text" name="redirect" value=""></p>
<p><strong><input type="button" onclick="view_url()" value="Сформировать url"></strong></p>
</form>

<div id="award_url" style="display: none;">
</div>

<script>
if (localStorage.getItem('energy_percent')) {
document.getElementById('awarding_energy').value = localStorage.getItem('energy_percent');
}
</script>
</body>
</html>